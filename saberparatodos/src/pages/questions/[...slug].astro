---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const questionsEntries = await getCollection('questions');
  return questionsEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// SEO Logic
const title = `Pregunta de ${entry.data.asignatura}: ${entry.data.tema} | OpenIcfes`;
const description = `Practica esta pregunta de ${entry.data.asignatura} sobre ${entry.data.tema}. Nivel de dificultad: ${entry.data.dificultad}/5. Prepárate para el ICFES Saber 11 con OpenIcfes.`;

// Schema.org (QAPage)
const schema = {
  "@context": "https://schema.org",
  "@type": "QAPage",
  "mainEntity": {
    "@type": "Question",
    "name": `Pregunta ${entry.data.id} - ${entry.data.asignatura}`,
    "text": entry.body.substring(0, 150) + "...",
    "answerCount": 1,
    "upvoteCount": 0,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": "Ver respuesta correcta en la plataforma",
      "upvoteCount": 0,
      "url": Astro.url.href
    }
  }
};
---

<Layout title={title} description={description} type="article">
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />

  <main class="container mx-auto px-4 py-8 text-[#F5F5DC] min-h-screen bg-[#121212]" data-pagefind-body>
    <a href="/" class="text-emerald-500 hover:underline mb-8 block">&larr; Volver al inicio</a>

    <article class="max-w-3xl mx-auto bg-white/5 p-8 rounded-lg border border-white/10">
      <header class="mb-6 border-b border-white/10 pb-4">
        <div class="flex justify-between items-center mb-4">
          <span class="text-xs font-bold uppercase tracking-widest text-emerald-500">{entry.data.asignatura} :: {entry.data.tema}</span>
        </div>

        <div class="flex flex-wrap gap-4 text-[10px] uppercase tracking-widest text-white/40">
            <span class="bg-white/5 px-2 py-1 rounded">ID: {entry.data.id}</span>
            <span class="bg-white/5 px-2 py-1 rounded">Grado: {entry.data.grado}°</span>
            <span class="bg-white/5 px-2 py-1 rounded">Nivel: {entry.data.dificultad}</span>
        </div>
      </header>

      <div class="prose prose-invert prose-lg max-w-none mb-8">
        <Content />
      </div>

      <footer class="text-sm opacity-50 pt-4 border-t border-white/10 flex gap-4">
        <span>Tema: {entry.data.tema}</span>
        <span>Dificultad: {entry.data.dificultad}/5</span>
      </footer>
    </article>
  </main>
</Layout>
